<html lang="en">
<head>
    <meta charset="UTF-8">

    <!-- Title: -->
    <title>Refugees and Terroristic Attacks in Europe</title>

    <!-- Import CSS style -->
    <link rel="stylesheet" href="structure.css">

    <!-- Shortcut icon in browser tab -->
    <link rel="shortcut icon" href="terrorist-thug.ico"/>

    <!--Font-->
    <link href="https://fonts.googleapis.com/css?family=Muli|Jura" rel="stylesheet">

    <!-- Leaflet CSS and Javascript file -->
    <!-- Check out http://leafletjs.com/examples/quick-start/ for an introduction on using leaflet: -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css"
          integrity="sha512-M2wvCLH6DSRazYeZRIm1JnYyh22purTM+FDB5CsyxtQJYeKq83arPe5wgbNmcFXGqiSH2XR8dT/fJISVA1r/zQ=="
          crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js"
            integrity="sha512-lInM/apFSqyy1o6s89K4iQUKg6ppXEgsVxT35HbzUupEVRh2Eu9Wdl4tHj7dZO0s1uvplcYGmt3498TtHq+log=="
            crossorigin=""></script>

    <!-- colors -->


    <!-- D3 & JS & JQUERY-->
    <script src="https://d3js.org/d3.v4.min.js"></script>

    <script src="map.js"></script>
    <script src="filter.js"></script>


    <!-- Slider -->
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="slider.js"></script>

    <!-- Map plot -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.css">
    <script src="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.js"></script>

    <!-- JS -->
    <script>
        d3.select(window).on('load', init);

        // Global variables
        var DATA;
        var FILTER =
            {target:     "all",
             terrorist:  "all",
             attacktype: "all",
             success:    "all",
             lowerdate:  new Date('2013.01.01'),
             upperdate:  new Date('2017.01.01')
            };
        var MAP;

        // Use custom colours based on http://vrl.cs.brown.edu/color:
        //const old_cat_col_dic = {1:"#41ab5d",2:"#fec44f",3:"#f03b20",4:"#df65b0",5:"#0570b0", 6:"#9e9ac8",7:"#08306b",8:"#54278f",9:"#238443"};

        //const cat_col_dic = {1:"#9e0142",2:"#d53e4f",3:"#f46d43",4:"#fdae61",5:"#fee08b", 6:"#deebf7",7:"#66c2a5",8:"#3288bd",9:"#5e4fa2"};

        const colors =

            //original ["#903235", "#c0f442", "#1c4c5e", "#fec44f", "#389eaa", "#38091c", "#b9dcca", "#f3614d","#252525"]
                ["#903235", "#c0f442", "#1c4c5e", "#fde0dd", "#389eaa", "#38091c", "#b9dcca", "#f3614d","#252525"]



        ;

        // Top 24 perpetrator categories:
        const terrorist_array = ["Anarchists","Anti-Immigrant extremists", "Anti-Muslim extremists",
            "Caucasus Emirate", "Caucasus Province of the Islamic State", "Conspiracy of Cells of Fire",
            "Cossack Separatists", "Dissident Republicans", "Donetsk People's Republic",
            "Informal Anarchist Federation","Islamic State of Iraq and the Levant (ISIL)","Jihadi-inspired extremists",
            "Kurdistan Workers' Party (PKK)", "Loyalists", "Luhansk People's Republic",
            "Muslim extremists", "Neo-Nazi extremists", "Oglaigh na hEireann", "Pro-Russia Militia",
            "Right Sector","Right-wing extremists", "The New Irish Republican Army", "Ukrainian nationalists",
            "Unknown"];

        const targets_array = ["Anarchists", "Government (general)", "Police", "Military", "Abortion related",
            "Airports & Aircraft", "Government (diplomatic)", "Educational institution", "Food or water supply",
            "Journalists & Media", "Maritime (includes ports and maritime facilities)", "NGO", "Other",
            "Private citizens & property", "Refugees", "Religious figures/institutions", "Telecommunication",
            "Terrorists/Non-state militias", "Tourists", "Transportation (other than aviation)", "Unknown",
            "Utilities", "Violent political parties"];


        function init() {
            d3.csv("data/gtd_europe.csv", function (mydata) {
                mydata.forEach(function (d) {
                    // the + sign converts numeric string to number:
                    d.eventid = +d.eventid -1;
                    d.date = d.iyear + "/" + d.imonth + "/" + d.iday;
                    // location
                    d.latitude = +d.latitude;
                    d.longitude = +d.longitude;
                    d.LatLng = new L.LatLng(d.latitude, d.longitude);
                    // filter criteria
                    d.success = +d.success;
                    d.attacktype = +d.attacktype1;
                    d.attacktype_txt = d.attacktype1_txt;
                    d.target = +d.targtype1;
                    // other
                    d.nkill = +d.nkill;
                    d.nwound = +d.nwound;
                    // perpetrator:
                    d.terrorist = d.gname;
                    d.terrorist_grouped = (terrorist_array.includes(d.gname)) ? d.gname : "Other";
                });

                DATA = mydata;


                // NOTE just temporal code ---------------------------
                // for counting of terrorists
                var targets = DATA.map(function(d){return d.target;});
                var t_dict = {};
                for(var i=0; i < targets.length; i++) {
                    var value = targets[i];
                    if (t_dict[value] == undefined)
                        t_dict[value] = 1;
                    else
                        t_dict[value]++;
                }
                console.log(t_dict);

                var items = Object.keys(t_dict).map(function(key) {
                    return [key, t_dict[key]];
                });
                items.sort(function(first, second) {
                    return second[1] - first[1];
                });

                console.log(items);
                //--------------------------------------------------


                // Callback
                drawMap();
                drawPoints();
            });
            init_legend();
        }
        
    </script>
</head>

<body>

<!-- Container (containing the whole visualisation) -->
<div id="container">

    <!-- TITLE: -->
    <div id="headline">
        <p>Violence against refugees <br> in the context of terroristic attacks <br> in Europe 2013 - 2016
        </p>
    </div>

    <!-- FILTERS: -->
    <div id="filters">
        <h3>Filter</h3>

        <!-- TARGET FILTER -->
        <label for="target_filter">Target/Victim:</label>
        <select id="target_filter" onchange="FILTER.target = this.value; drawPoints();" style="width:100%;max-width:90%;">
            <option value="all" selected>All</option>
            <option value="1">Anarchists</option>
            <option value="2">Government (general)</option>
            <option value="3">Police</option>
            <option value="4">Military</option>
            <option value="5">Abortion related</option>
            <option value="6">Airports & Aircraft</option>
            <option value="7">Government (diplomatic)</option>
            <option value="8">Educational institution</option>
            <option value="9">Food or water supply</option>
            <option value="10">Journalists & Media</option>
            <option value="11">Maritime (includes ports and maritime facilities)</option>
            <option value="12">NGO</option>
            <option value="23">Other</option>
            <option value="14">Private citizens & property</option>
            <option value="13">Refugees</option>
            <option value="15">Religious figures/institutions</option>
            <option value="16">Telecommunication</option>
            <option value="17">Terrorists/Non-state militias</option>
            <option value="18">Tourists</option>
            <option value="19">Transportation (other than aviation)</option>
            <option value="20">Unknown</option>
            <option value="21">Utilities</option>
            <option value="22">Violent political parties</option>
        </select>
        <br><br>

        <!-- TERRORIST FILTER -->
        <label for="target_filter">Perpetrator:</label>
        <select id="target_filter" onchange="FILTER.terrorist = this.value; drawPoints();" style="width:100%;max-width:90%;">
            <option value="all" selected>All</option>
            <option value="Anarchists">Anarchists</option>
            <option value="Anti-Immigrant extremists">Anti-Immigrant extremists</option>
            <option value="Anti-Muslim extremists">Anti-Muslim extremists</option>
            <option value="Caucasus Emirate">Caucasus Emirate</option>
            <option value="Caucasus Province of the Islamic State">Caucasus Province of the Islamic State</option>
            <option value="Conspiracy of Cells of Fire">Conspiracy of Cells of Fire</option>
            <option value="Cossack Separatists">Cossack Separatists</option>
            <option value="Dissident Republicans">Dissident Republicans</option>
            <option value="Donetsk People's Republic">Donetsk People's Republic</option>
            <option value="Informal Anarchist Federation">Informal Anarchist Federation</option>
            <option value="Islamic State of Iraq and the Levant (ISIL)">Islamic State of Iraq and the Levant (ISIL)</option>
            <option value="Jihadi-inspired extremists">Jihadi-inspired extremists</option>
            <option value="Kurdistan Workers' Party (PKK)">Kurdistan Workers' Party (PKK)</option>
            <option value="Loyalists">Loyalists</option>
            <option value="Luhansk People's Republic">Luhansk People's Republic</option>
            <option value="Muslim extremists">Muslim extremists</option>
            <option value="Neo-Nazi extremists">Neo-Nazi extremists</option>
            <option value="Oglaigh na hEireann">Oglaigh na hEireann</option>
            <option value="Other">Other</option>
            <option value="Pro-Russia Militia">Pro-Russia Militia</option>
            <option value="Right Sector">Right Sector</option>
            <option value="Right-wing extremists">Right-wing extremists</option>
            <option value="The New Irish Republican Army">The New Irish Republican Army</option>
            <option value="Ukrainian nationalists">Ukrainian nationalists</option>
            <option value="Unknown">Unknown</option>
        </select>
        <br><br>

        <!-- ATTACK TYPE: -->
        <label for="attacktype_filter">Attack type:</label>
        <!-- Attention: numbering in attacktype and numbering in filter for attacktype_txt as in codebook: -->
        <select id="attacktype_filter" onchange="FILTER.attacktype = this.value; drawPoints();" style="width:100%;max-width:90%;">
            <option value="all" selected>All</option>
            <option value="1">Assassination</option>
            <option value="2">Armed Assault</option>
            <option value="3">Bombing/Explosion</option>
            <option value="4">Hijacking</option>
            <option value="5">Hostage Taking (Barricade Incident) </option>
            <option value="6">Hostage Taking (Kidnapping) </option>
            <option value="7">Facility/Infrastructure Attack</option>
            <option value="8">Unarmed Assault</option>
            <option value="9">Unknown</option>
        </select>
        <br><br>

        <!-- SUCCESS: -->
        <label for="success_filter">Attack succeeded:</label>
        <select id="success_filter" onchange="FILTER.success = this.value; drawPoints();" style="width:100%;max-width:90%;">
            <option value="all" selected>All</option>
            <option value="1">Yes</option>
            <option value="0">No</option>
        </select>
    </div>

    <!-- INFOBOX: -->
    <div id="infobox">
        <h3>Infobox</h3>
        <div class="infos"></div>
    </div>

    <!-- MAP: -->
    <div id="mapid" height="180px"></div>

    <!-- TIME SLIDER: -->
    <div id="slider">
        <h3 style = "margin-right: 0; margin-bottom:0;margin-left:3%;float:left;">Time</h3>
        <div id="slider-range" style = "margin-top:1.8%; margin-left:10%;margin-right:7%;"></div>
        <div id ="min"></div>
        <div id = "max"></div>
    </div>
    
    <!-- LEGEND: -->
    <div id="legend">
      <input id="toggle1" type="checkbox" class="toggle" unchecked>
      <label for="toggle1" id="legend_lab">Legend</label>
      <div id="expand">
            <!-- Filters: -->
            <b>Attack types:</b> <br>
            <div style="background-color:#41ab5d;" class = "bullets">&nbsp;</div>&nbsp;Assassination<br>
            <div style="background-color:#fec44f;" class = "bullets">&nbsp;</div>&nbsp;Armed Assault<br>
            <div style="background-color:#f03b20;" class = "bullets">&nbsp;</div>&nbsp;Bombing/Explosion<br>
            <div style="background-color:#df65b0;" class = "bullets">&nbsp;</div>&nbsp;Hijacking<br>
            <div style="background-color:#0570b0;" class = "bullets">&nbsp;</div>&nbsp;Hostage Taking (Barricade Incident)<br>
            <div style="background-color:#9e9ac8;" class = "bullets">&nbsp;</div>&nbsp;Hostage Taking (Kidnapping)<br>
            <div style="background-color:#08306b;" class = "bullets">&nbsp;</div>&nbsp;Facility/Infrastructure Attack<br>
            <div style="background-color:#54278f;" class = "bullets">&nbsp;</div>&nbsp;Unarmed Assault<br>
            <div style="background-color:#238443;" class = "bullets">&nbsp;</div>&nbsp;Unknown<br>
            <!-- Circle Size: -->
            <br>
            <b>Number of fatalities:</b>
            <svg id="circleSize" style="width: 260; height:170;"></svg>
      </div>
    </div>
    
    <!-- ABOUT: -->
    <div id="about">
      <input id="toggle2" type="checkbox" class="toggle" unchecked>
      <label for="toggle2" id="legend_lab">About</label>
      <div id="expand_about">
            <h2>Motivation</h2>
            <p>The last years in Europe have been marked by an ongoing news coverage of terror attacks by Islamist terrorists
            as well as xenophobic motivated attacks on refugee accommodations.
            We have set out to find answers to the following questions:
            <ol>
                <li>Are there specific areas that suffer more often from
                    (specific kinds of) terror attacks than others?</li>
                <li>Are there differences in the amount of attacks, in the kind of
                    attacks and in the concerned areas?</li>
                <li>Which actors occur? What attacks are they responsible for?
                    Are there changes over the years? Are they active in specific areas?</li>
            </ol>
            </p>


            <h2>Data</h2>
            <p>The Global Terrorism Database (GTD) is a database including information on
                terrorist events around the world from 1970 to 2016. It includes data on domestic, transnational and international
                terrorist incidents and provides relevant information, such as the date, location, weapons, target and the
                responsible person or group if known. The global terrorism database was introduced in 2001 at the University of
                Maryland. It is provided by the National Consortium for the Study of Terrorism and Responses to Terrorism (START)
                which still works in close collaboration with multiple researchers from the University of Maryland.
                The data is based on publicly available, open-source materials and can be downloaded <a
                        href="https://www.start.umd.edu/gtd/contact/">here</a> on GTD's website.
                Incidents have been included if they met START's definition of terrorism as an "intentional act of violence or threat of violence by a non-state actor" and at least two of the following criteria:
            <ol>
                <li>The violent act was aimed at attaining a political, economic, religious, or social goal</li>
                <li>The violent act included evidence of an intention to coerce, intimidate, or convey some other message to a larger audience (or audiences) other than the immediate victims </li>
                <li>The violent act was outside the precepts of International Humanitarian Law.</li>
            </ol>
            </p>

            <h2>Methodology</h2>
            <h3>Data pre-processing</h3>
            <ul>
                <li>We restricted the time range for recent years: 01.01.2013 - 31.12.2016 (newer data not available)</li>
                <li>only Eastern + Western Europe</li>
                <li><b>Targets:</b> We took a closer look at the summaries of the attacks in the GTD category "Other"
                    which turned out to be mostly <it>refugee related</it>. Therefore, we created a new category "Refugees".</li>
                <li><b>Perpetrators:</b> We reduced the number of terrorist groups by only taking the most active ones.
                    There are still 24 (with more than 5 attacks each) while the remaining ones are grouped in "Other".</li>
            </ul>
            <p></p>

            <h2>Discussion/Conclusion</h2>
            <p></p>
       </div>
    </div>
    
</div>

</body>

</html>
